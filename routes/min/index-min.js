function promisifyHotelInfoRequests(e){var e=e,t="https://maps.googleapis.com/maps/api/place/nearbysearch/json?location="+e.latitude+","+e.longitude+"&radius=1500&types=food&key="+keys.key;return promisifiedHttpsGet(t).then(function r(o){return e.restaurants=getRestaurants(o),t="https://maps.googleapis.com/maps/api/place/nearbysearch/json?location="+e.latitude+","+e.longitude+"&radius=600&types=subway_station&key="+keys.key,promisifiedHttpsGet(t)}).then(function o(t){return console.log("entered subway area"),e.subways=getSubways(t),e})["catch"](function s(e){throw new Error(e)})}function getRestaurants(e){var t=[],r=JSON.parse(e).results;return r.forEach(function(e){var r={restaurantName:e.name,priceLevel:e.price_level,rating:e.rating};t.push(r)}),t}function getSubways(e){var t={stations:[]},r=JSON.parse(e).results;return r.forEach(function(e){t.stations.push({name:e.name})}),t}var express=require("express"),router=express.Router();module.exports=router;var keys=require("../apiKeys"),https=require("https"),Promise=require("bluebird"),hotels=require("../hotel.js"),request=Promise.promisify(require("request"));Promise.promisifyAll(https);var promisifiedHttpsGet=Promise.method(function(e){return new Promise(function(t,r){var o="";https.get(e,function(e){e.on("data",function r(e){o+=e}),e.on("end",function s(){return t(o)}),e.on("error",function n(e){throw new Error(e)})})})});filteredHotels=hotels.map(function(e){var t={address:e.location.address.addressLine1,name:e.name,latitude:e.location.latitude,longitude:e.location.longitude,neighborhoodName:e.location.neighborhoodName,overallGuestRating:e.overallGuestRating,starRating:e.starRating,thumbnailUrl:e.thumbnailUrl,totalReviewCount:e.totalReviewCount,url:e.url,zip:e.location.address.cityName};return t}),router.get("/nearby",function(e,t){hotelsPromises=filteredHotels.map(promisifyHotelInfoRequests),Promise.all(hotelsPromises).then(function r(e){console.log(e)})});